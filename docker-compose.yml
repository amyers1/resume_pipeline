services:
    resume-generator:
        build: .
        container_name: resume-pipeline
        environment:
            - USER_ID=${USER_ID:-1000}
            - GROUP_ID=${GROUP_ID:-1000}
        volumes:
            # Core application files (read-only)
            - ./career_profile.json:/app/career_profile.json:ro
            - ./.env:/app/.env:ro

            # Output directory (read-write)
            - ./output:/app/output:rw

            # Jobs directory (read-only)
            - ./jobs:/app/jobs:ro

            # Templates directory (read-only)
            # Mounted so you can update templates without rebuilding
            - ./templates:/app/templates:ro

        # Default command can be overridden
        # Example: docker-compose run --rm resume-generator
        #
    resume-worker:
        build: .
        container_name: resume-worker
        environment:
            - USER_ID=${USER_ID:-1000}
            - GROUP_ID=${GROUP_ID:-1000}
            - ENABLE_RABBITMQ=true
        env_file:
            - .env
        volumes:
            - ./career_profile.json:/app/career_profile.json:ro
            - ./.env:/app/.env:ro
            - ./output:/app/output:rw
            - ./jobs:/app/jobs:ro
            - ./templates:/app/templates:ro
        command: python resume_worker.py
        restart: unless-stopped
